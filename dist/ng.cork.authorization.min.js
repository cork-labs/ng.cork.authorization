!function(a){"use strict";function b(a){return!!a&&h(a.then)}function c(a){return i(a)&&h(a[a.length-1])}function d(a,b){return a.replace(/:(\w+)/g,function(a,c){return a.replace(":"+c,b[c])})}var e=a.module("ng.cork.authorization",["ngRoute"]),f=a.isString,g=a.isObject,h=a.isFunction,i=a.isArray;e.factory("CorkAuthorizationError",[function(){var a=function(a,b){this.redirectPath=a,this.$$route=b};return a}]),e.provider("corkAuthorization",[function(){var a=this;a.$authorizeRoute=["corkAuthorization",function(a){return a.$authorizeRoute()}];var e={};a.middleware=function(b,d){if(!f(b))throw new Error("Invalid corkAuthorization middleware name.");if(arguments.length>1){if(e[b])throw new Error('corkAuthorization middleware "'+b+'" is already registered.');if(!h(d)&&!c(d))throw new Error('Invalid corkAuthorization middleware "'+b+'".');return e[b]=d,a}if(!e[b])throw new Error('Unknown corkAuthorization middleware "'+b+'".');return e[b]},a.$get=["$rootScope","$q","$location","$route","CorkAuthorizationError",function(c,e,j,k,l){c.$on("$routeChangeError",function(a,b,c,e){var g;if(e instanceof l){if(f(e.redirectPath))g=e.redirectPath;else{var i=b.$$route,k=i.corkAuthorization.onReject;f(k)?g=k:h(k)&&(g=k(i))}g||(g=c&&c.$$route?d(c.$$route.originalPath,c.params):"/"),j.path(g)}});var m=function(){var d=this;d.$authorizeRoute=function(){var a,d,j=e.defer(),m=k.current.$$route;if(g(m.corkAuthorization)&&g(m.corkAuthorization.rules)){if(a=m.corkAuthorization.rules,d=[],h(a))a=[a];else if(!i(a))throw new Error('Invalid corkAuthorization rules in $$route "'+m+'".')}else j.resolve();var n,o;return a.forEach(function(a,c){if(!h(a))throw new Error('Invalid corkAuthorization rule in $$route "'+m+'".');o=a(k.current),b(o)?o.then(n.resolve,n.reject):(n=e.defer(),d.push(n.promise),o?n.reject(o):n.resolve())}),e.all(d).then(function(a){j.resolve()},function(a){if(!a||f(a))a=new l(a);else if(!(a instanceof l))throw new Error("Invalid route rejection error. Must be string with redirectUrl or a CorkAuthorizationError object.");a.$$route=a.$$route=m,j.reject(a),c.$broadcast("corkAuthorization.rejected",a)}),j.promise},d.middleware=function(b,c){var e=arguments.length>1?a.middleware(b,c):a.middleware(b);return e===a?d:e}};return new m}]}])}(angular);