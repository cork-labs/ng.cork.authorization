!function(a){"use strict";function b(a){return!!a&&h(a.then)}function c(a){return i(a)&&h(a[a.length-1])}function d(a,b){return a.replace(/:(\w+)/g,function(a,c){return a.replace(":"+c,b[c])})}var e=a.module("ng.cork.authorization",["ngRoute"]),f=a.isString,g=a.isObject,h=a.isFunction,i=a.isArray;e.factory("CorkAuthorizationError",[function(){var a=function(a){this.redirectPath=a};return a}]),e.provider("corkAuthorization",[function(){var e=this,j={defaultRedirectPath:"/"};e.configure=function(b){a.extend(j,b)},e.$authorizeRoute=["corkAuthorization",function(a){return a.$authorizeRoute()}];var k={};e.middleware=function(a,b){if(!f(a))throw new Error("Invalid corkAuthorization middleware name.");if(arguments.length>1){if(k[a])throw new Error('corkAuthorization middleware "'+a+'" is already registered.');if(!h(b)&&!c(b))throw new Error('Invalid corkAuthorization middleware "'+a+'".');return k[a]=b,e}if(!k[a])throw new Error('Unknown corkAuthorization middleware "'+a+'".');return k[a]},e.$get=["$rootScope","$q","$location","$route","CorkAuthorizationError",function(a,c,k,l,m){a.$on("$routeChangeError",function(a,b,c,e){var g;if(e instanceof m){var i=b.$$route,j=i.corkAuthorization,l=j&&j.onReject;if(f(e.redirectPath))g=e.redirectPath;else if(j.hasOwnProperty("onReject"))if(f(l))g=l;else{if(!h(l))throw new Error("Invald onReject handler. Must be an array or function.");g=l(i)}g||(g=c&&c.$$route?d(c.$$route.originalPath,c.params):"/"),k.path(g)}});var n=function(){var d=this;d.middleware=function(a,b){var c=arguments.length>1?e.middleware(a,b):e.middleware(a);return c===e?d:c},d.$authorizeRoute=function(){var d,e,j=c.defer(),k=l.current,n=k.$$route,o=n.corkAuthorization;if(!g(o)||!i(o.rules))return j.resolve(),j.promise;d=n.corkAuthorization.rules,e=[];var p,q;return d.forEach(function(a,d){if(!h(a))throw new Error("Invalid corkAuthorization rule in $$route.");q=a(n),b(q)?e.push(q):(p=c.defer(),e.push(p.promise),q?p.resolve():p.reject())}),c.all(e).then(function(a){j.resolve()},function(b){if(!b||f(b))b=new m(b);else if(!(b instanceof m))throw new Error("Invalid route rejection error. Must be string with redirectUrl or a CorkAuthorizationError object.");b.$$route=b.$$route=n,j.reject(b),a.$broadcast("corkAuthorization.rejected",b)}),j.promise}};return Object.defineProperty(n.prototype,"defaultRedirectPath",{get:function(){return j.defaultRedirectPath}}),new n}]}])}(angular);